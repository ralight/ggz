dnl Process this file with autoconf to produce a configure script.

AC_INIT(acinclude.ggz)
AM_INIT_AUTOMAKE(ggz-grubby, 0.0.6pre)
AM_CONFIG_HEADER(config.h)
AM_MAINTAINER_MODE

dnl Compiling Options
dnl =====================
AC_ARG_ENABLE(perl,  [  --disable-perl        Exclude perl modules],, enable_perl=yes)
AC_ARG_ENABLE(ruby,  [  --disable-ruby        Exclude ruby modules],, enable_ruby=yes)

dnl Check for standard build environment
dnl ====================================
AC_PROG_CC
AC_ISC_POSIX
AC_PROG_INSTALL
AM_PROG_CC_STDC
AC_PROG_MAKE_SET
AM_PROG_LIBTOOL

dnl GGZ checks
dnl ==========
AC_GGZ_INTL
AC_GGZ_GGZCORE

dnl Use -Wall if we have gcc.
dnl ========================
changequote(,)dnl
if test "x$GCC" = "xyes"; then
  case " $CFLAGS " in
  *[\ \	]-Wall[\ \	]*) ;;
  *) CFLAGS="$CFLAGS -Wall" ;;
  esac
fi
changequote([,])dnl


dnl Module options
dnl ===========
if test "$enable_perl" = yes; then
	echo -n "Extra check: perl... "

	AC_MSG_RESULT(not yet supported.)
fi

if test "$enable_ruby" = yes; then
	echo -n "Extra check: ruby... "

	incs="/usr/local/lib/ruby/1.6/i386-linux /usr/lib/ruby/1.6/i386-linux /usr/local/lib/ruby/1.7/i386-linux /usr/lib/ruby/1.7/i386-linux"
	AC_GGZ_FIND_FILE("ruby.h", $incs, ruby_incdir)
	ruby_includes="$ruby_incdir"

	libs="/usr/local/lib /usr/lib"
	AC_GGZ_FIND_FILE("libruby.so", $libs, ruby_libdir)
	rubystyle=old
	if test "x$ruby_libdir" = "xNO"; then
		AC_GGZ_FIND_FILE("libruby1.7.so", $libs, ruby_libdir)
		rubystyle=new
	fi
	ruby_libraries="$ruby_libdir"

	if test "x$ruby_includes" = "xNO" || test "x$ruby_libraries" = "xNO"; then
		AC_MSG_RESULT(no.)
		ruby_includes=""
		ruby_libraries=""
	else
		ruby_includes="-I $ruby_includes"
		if test "$rubystyle" = "old"; then
			ruby_libraries="-L $ruby_libraries -lruby"
		else
			ruby_libraries="-L $ruby_libraries -lruby1.7"
		fi
		AC_MSG_RESULT(ok.)
		AC_SUBST(ruby_includes)
		AC_SUBST(ruby_libraries)
		AC_DEFINE(EMBED_RUBY)
	fi
fi

dnl Create files
dnl ============

if test "x$prefix" = "xNONE"; then
	prefix="/usr/local"
fi

grubbydir="${prefix}/share/grubby"
grubbymoddir="${prefix}/lib/grubby"

AC_DEFINE_UNQUOTED(GRUBBYDIR, "${grubbydir}")
AC_DEFINE_UNQUOTED(PREFIX, "${prefix}")

AC_SUBST(grubbymoddir)
AC_SUBST(grubbydir)

AC_OUTPUT(Makefile
		grubby/Makefile
		grubby/src/Makefile
		grubby/modules/Makefile
		grubby/data/Makefile
		grubby/data/grubby-config
		man/Makefile)

dnl Status output
dnl =============

echo ""
echo "Configured grubby. Type 'make' to compile it, followed by a 'make install'."
echo ""

