
<para>
  We now list a complete reference of messages which get
  passed to and from the GGZ server.  This listing conforms to
  protocol version &protonum;.
</para>

<para>
  Three types of data are exchanged between the client and the server:
  <itemizedlist>
    <listitem>
  <para>char: a 1-byte signed char</para>
    </listitem>
    <listitem>
  <para>int: a 4-byte signed integer in network byte order</para>
    </listitem>
    <listitem>
  <para>
    string: a multibyte null-terminated string preceded by
    its length (including null-termination) as an integer.
  </para>
    </listitem>
  </itemizedlist>
</para>

<para>
  Interactions take one of three forms: server messages, client
  requests, and server responses.  Each interaction is prefaced
  by an opcode identifying it (some interactions consist solely
  of the opcode).  The opcode (stored as an enumerated value) is
  sent as an int.
</para>

<section id ="both-directions"><title>Messages sent in both directions</title>

  <refentry id="msg.session"><?dbhtml filename="msg_session.html">
    <refmeta>
      <indexterm>
	<primary>SESSION</primary>
      </indexterm>
      <refentrytitle>SESSION</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>SESSION</refname>
      <refpurpose>Session start</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
		      &lt;SESSION&gt;
			   ...
			  &lt;/SESSION&gt;
		    </entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Session start tag sent from server or client</para>
      <refsect2>
	<title>Message Data</title>
	  <para>
	  None
	  </para>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  The SESSION tag is sent from the server to the client
	  upon a successful connection. It does neither guarantee
	  a successful login nor does it indicate if the client and
	  server version match.
	  It is also sent by the client, when attempting to login,
	  or when requesting a direct connection between game client and game
	  server.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="msg.ping"><?dbhtml filename="msg_ping.html">
    <refmeta>
      <indexterm>
	<primary>PING</primary>
      </indexterm>
      <refentrytitle>PING</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>PING</refname>
      <refpurpose>Lag measurement challenge</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	  <colspec colnum="2" colname="C2">
	  <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
		      &lt;PING ID='_id_'/&gt;
		    </entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
	            <entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
                    <entry>ID</entry>
                    <entry>string</entry>
                    <entry>1h3k5lmfs</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Periodically sent request</para>

      <refsect2>
        <title>Message Data</title>
        <variablelist>
          <varlistentry>
            <term><emphasis role="bold">ID</emphasis></term>
            <listitem>
              <para>
                Unique identifier for this ping; it is sent back in the pong.
              </para>
            </listitem>
          </varlistentry>
        </variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  The PING tag is sent periodically from the server to all clients
	  in order to obtain their response (the
	  <link linkend="msg.pong">PONG</link> tag) for lag calculation.  It
          may also be sent by the client to the server at any time to
          determine the client's own lag time.
	</para>
      </refsect2>
    </refsect1>
  </refentry>


  <refentry id="msg.pong"><?dbhtml filename="msg_pong.html">
    <refmeta>
      <indexterm>
	<primary>PONG</primary>
      </indexterm>
      <refentrytitle>PONG</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>PONG</refname>
      <refpurpose>Lag measurement response</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	  <colspec colnum="2" colname="C2">
	  <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
		      &lt;PONG/&gt;
		    </entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
			<entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
                    <entry>ID</entry>
                    <entry>string</entry>
                    <entry>1h3k5lmfs</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Response to lag measurement challenge</para>

      <refsect2>
        <title>Message Data</title>
        <variablelist>
          <varlistentry>
            <term><emphasis role="bold">ID</emphasis></term>
            <listitem>
              <para>
                Unique identifier for this pong - the same string that was
                sent in the ping.
              </para>
            </listitem>
          </varlistentry>
        </variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  The PONG should be sent immediately in response to the
	  <link linkend="msg.ping">PING</link> tag.  The resulting
          round-trip time can be measured to determine the player's lag.
          When the server sends the ping, the lag measurement is tracked and
          reported to all players in the room (including that player).  But
          for a lagging client - or one that is not in a room - this is not
          helpful.  Thus the client can also send a ping to determine its own
          latency.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

</section>


<section id ="server-to-client"><title>Server to client messages</title>

  <refentry id="msg.room"><?dbhtml filename="msg_room.html">
    <refmeta>
      <indexterm>
	<primary>ROOM</primary>
      </indexterm>
      <refentrytitle>ROOM</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>ROOM</refname>
      <refpurpose>List entry describing one room</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	  <colspec colnum="2" colname="C2">
	  <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
		      &lt;ROOM ID="id" NAME="name" GAME="game" PLAYERS="players"&gt;
		      &lt;DESC&gt;desc&lt;/DESC&gt;
		      &lt;/ROOM&gt;
		    </entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
		    <entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
		    <entry>ID</entry>
		    <entry>string</entry>
		    <entry>0</entry>
		  </row>

		  <row rowsep="1">
		    <entry>NAME</entry>
		    <entry>string</entry>
		    <entry>TicTacToe</entry>
		  </row>

		  <row rowsep="1">
		    <entry>GAME</entry>
		    <entry>int</entry>
		    <entry>4</entry>
		  </row>

		  <row rowsep="1">
		    <entry>PLAYERS</entry>
		    <entry>int</entry>
		    <entry>14</entry>
		  </row>

		  <row rowsep="1">
		    <entry>DESC</entry>
		    <entry>string</entry>
		    <entry>Sample TTT room</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>A list entry describing one room at a GGZ server</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">ID</emphasis></term>
	    <listitem>
	      <para>
		Unique identifier for this room
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">NAME</emphasis></term>
	    <listitem>
	      <para>
		Room name
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">GAME</emphasis></term>
	    <listitem>
	      <para>
		The identifier of the game associated with this room
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">PLAYERS</emphasis></term>
	    <listitem>
	      <para>
		The number of players currently in the room.  This value
		is sent in the room list and may be periodically
		<link linkend="msg.update">updated</link>.  However this
		information is not updated immediately, so the client's
		knowledge may become stale.  For the current room the
		client should use the list of players in the room as a more
		accurate value.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">DESC</emphasis></term>
	    <listitem>
	      <para>
		Verbose room description (sent only if requested)
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  A list of room tags is sent when requesting the list of available
	  rooms on a server, typically done after logging in.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="msg.game"><?dbhtml filename="msg_game.html">
    <refmeta>
      <indexterm>
	<primary>GAME</primary>
      </indexterm>
      <refentrytitle>GAME</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>GAME</refname>
      <refpurpose>List entry describing one game type</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	  <colspec colnum="2" colname="C2">
	  <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
		      &lt;GAME ID="id" NAME="name" VERSION="version"&gt;
			    &lt;PROTOCOL ENGINE="engine" VERSION="version"/&gt;
				&lt;ALLOW PLAYERS="players" BOTS="bots" SPECTATORS="spectator"/&gt;
				&lt;ABOUT AUTHOR="author" URL="url"/&gt;
				&lt;DESC&gt;desc&lt;/DESC&gt;
			  &lt;/GAME&gt;
		    </entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
			<entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
		    <entry>ID</entry>
		    <entry>int</entry>
			<entry>0</entry>
		  </row>

		  <row rowsep="1">
		    <entry>NAME</entry>
		    <entry>string</entry>
			<entry>TicTacToe</entry>
		  </row>

		  <row rowsep="1">
		    <entry>VERSION</entry>
		    <entry>string</entry>
			<entry>0.2</entry>
		  </row>

		  <row rowsep="1">
		    <entry>ENGINE</entry>
		    <entry>string</entry>
			<entry>TicTacToe</entry>
		  </row>

		  <row rowsep="1">
		    <entry>PLAYERS</entry>
		    <entry>string</entry>
			<entry>4</entry>
		  </row>

		  <row rowsep="1">
		    <entry>BOTS</entry>
		    <entry>string</entry>
			<entry>1..3</entry>
		  </row>

		  <row rowsep="1">
		    <entry>SPECTATORS</entry>
		    <entry>string</entry>
			<entry>true</entry>
		  </row>

		  <row rowsep="1">
		    <entry>AUTHOR</entry>
		    <entry>string</entry>
			<entry>Anonymous Coward</entry>
		  </row>

		  <row rowsep="1">
		    <entry>URL</entry>
		    <entry>string</entry>
			<entry>http://ggz.sourceforge.net/</entry>
		  </row>

		  <row rowsep="1">
		    <entry>DESC</entry>
		    <entry>string</entry>
			<entry>My first game</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>
	    A list entry describing one game at a GGZ server,
		which may be used in one or more rooms.
	  </para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">ID</emphasis></term>
	    <listitem>
	      <para>
		Unique identifier for this game
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">NAME</emphasis></term>
	    <listitem>
	      <para>
		The name of the game
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">VERSION</emphasis></term>
	    <listitem>
	      <para>
		Game server program version, and game server/client
		communication protocol version
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">ENGINE</emphasis></term>
	    <listitem>
	      <para>
		Generalized game type, which is used for frontend selection
	      </para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><emphasis role="bold">PLAYERS</emphasis></term>
	    <listitem>
	      <para>
		The number of players allowed in this game, in the form of a
                list of individual numbers and/or a single range of numbers,
                separated by spaces.  For instance '1 2 3 5..10' includes
                both a list and a range.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">BOTS</emphasis></term>
	    <listitem>
	      <para>
		The number of AI bots allowed at a table of this game.  The
                form is that of a number list (the same as for the PLAYERS
                element).  Zero bots is always allowed and will not be listed.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">SPECTATORS</emphasis></term>
	    <listitem>
	      <para>
		Whether spectators are allowed or not, either 'true' or
                'false'.
	      </para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><emphasis role="bold">AUTHOR</emphasis></term>
	    <listitem>
	      <para>
		Name of the author or author team
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">URL</emphasis></term>
	    <listitem>
	      <para>
		Pointer to the project homepage of the game server
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">DESC</emphasis></term>
	    <listitem>
	      <para>
		Description for the game type offered by this server
	      </para>
	    </listitem>
	  </varlistentry>

	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  After the client requested the list of games,
	  a <link linkend="rsp.list">LIST</link> containing some
	  game entries is sent from the server to the client.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="msg.server.server"><?dbhtml filename="msg_server_server.html">
    <refmeta>
      <indexterm>
	<primary>SERVER</primary>
      </indexterm>
      <refentrytitle>SERVER</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>SERVER</refname>
      <refpurpose>Server identification</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	  <colspec colnum="2" colname="C2">
	  <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
		      &lt;SERVER ID="id" NAME="name" VERSION="version" STATUS="status"&gt;
			    &lt;OPTIONS CHATLEN="chatlen"/&gt;
			  &lt;/SERVER&gt;
		    </entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
			<entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
		    <entry>ID</entry>
		    <entry>string</entry>
			<entry>GGZ-0.0.6</entry>
		  </row>

		  <row rowsep="1">
		    <entry>NAME</entry>
		    <entry>string</entry>
			<entry>Harry's GGZ server</entry>
		  </row>

		  <row rowsep="1">
		    <entry>VERSION</entry>
		    <entry>int</entry>
			<entry>6</entry>
		  </row>

		  <row rowsep="1">
		    <entry>STATUS</entry>
		    <entry>string</entry>
			<entry>ok</entry>
		  </row>

		  <row rowsep="1">
		    <entry>CHATLEN</entry>
		    <entry>int</entry>
			<entry>512</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>An identification message from the server</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">ID</emphasis></term>
	    <listitem>
	      <para>
		Server identification string (including version number)
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">VERSION</emphasis></term>
	    <listitem>
	      <para>
		Integer version number
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">NAME</emphasis></term>
	    <listitem>
	      <para>
		Descriptive name of that server
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">STATUS</emphasis></term>
	    <listitem>
	      <para>
		Current server status, can be either 'ok' or 'full'
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">CHATLEN</emphasis></term>
	    <listitem>
	      <para>
		Maximum length of chat messages
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  The SERVER tag is sent from the server to the client right
	  after the SESSION tag. It must be examined by the client to
	  determine whether a login is possible or not.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="msg.motd"><?dbhtml filename="msg_motd.html">
    <refmeta>
      <indexterm>
	<primary>MOTD</primary>
      </indexterm>
      <refentrytitle>MOTD</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>MOTD</refname>
      <refpurpose>Server Message of the day</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
		      &lt;MOTD PRIORITY="priority"&gt;
			    &lt;![CDATA[...]]&gt;
			  &lt;/MOTD&gt;
		    </entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
		    <entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
		    <entry>PRIORITY</entry>
		    <entry>string</entry>
			<entry>normal</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Message of the day (MOTD) from the Server</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">PRIORITY</emphasis></term>
	    <listitem>
	      <para>
		MOTD priority used to determine whether to display it or not
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">Data (CDATA)</emphasis></term>
	    <listitem>
	      <para>
		All lines of the MOTD, separated by the newline character
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  The MOTD tag is sent from the server to the client upon
	  successful login (ie. after the
	  <link linkend="rsp.result">RESULT</link> tag belonging to a
	  <link linkend="req.login">LOGIN</link> request)
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="msg.update"><?dbhtml filename="msg_update.html">
    <refmeta>
      <indexterm>
	<primary>UPDATE</primary>
      </indexterm>
      <refentrytitle>UPDATE</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>UPDATE</refname>
      <refpurpose>
	Notification that the list of players
	or the list of tables in a room has changed,
	or the list of rooms or game types on a server.
      </refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
			  &lt;UPDATE TYPE="type" ACTION="action" ROOM="room" FROMROOM="from" TOROOM="to"&gt;
			</entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
		    <entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
		    <entry>TYPE</entry>
		    <entry>string</entry>
		    <entry>player</entry>
		  </row>

		  <row rowsep="1">
		    <entry>ACTION</entry>
		    <entry>string</entry>
		    <entry>add</entry>
		  </row>

		  <row rowsep="1">
		    <entry>ROOM</entry>
			<entry>int</entry>
			<entry>1</entry>
		  </row>

		  <row rowsep="1">
		    <entry>FROMROOM</entry>
		    <entry>int</entry>
		    <entry>2</entry>
		  </row>


		  <row rowsep="1">
		    <entry>TOROOM</entry>
		    <entry>int</entry>
		    <entry>3</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>
	Notification from the server that the list of players in
	the current room has been modified since the last update,
	or that a table has been added, removed or changed its state,
	or that a room or game type has been added or removed.
      </para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">TYPE</emphasis></term>
	    <listitem>
	      <para>
		Update type. Can be 'player' or 'table' for room updates,
		or 'room' or 'game' for server updates.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">ACTION</emphasis></term>
	    <listitem>
	      <para>
		Action to do. Can be 'add', 'delete', 'lag', or
		'stats' for players;
		'add', 'delete', 'join', 'leave', 'status', 'desc', or 'seat'
		for tables;
		'players' for rooms.
		No game updates are possible at this time.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">ROOM</emphasis></term>
	    <listitem>
	      <para>
		Room to which the update applies.
		Only used for types 'player' and 'table'.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">FROMROOM</emphasis></term>
	    <listitem>
	      <para>
		Room the player is coming from.
		Only used for type 'add'.
		The room may be -1 indicating "no room".
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">ROOM</emphasis></term>
	    <listitem>
	      <para>
		Room the player is going to.
		Only used for type 'delete'.
		The room may be -1 indicating "no room".
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  An UPDATE tag is sent from the server to the client
	  if the list of players, tables, rooms or games has changed
	  since the last update. It is <emphasis>not</emphasis>
	  sent upon initial entry to a room or server; the information is
          originally sent in a <link linkend="req.list">LIST</link>.  An
	  update is sent when the information of that type changes.
	</para>
	<para>
	  The UPDATE tag contains one or more tags of type
	  <link linkend="rsp.list.player">PLAYER</link>,
	  <link linkend="rsp.list.table">TABLE</link>,
	  <link linkend="msg.room">ROOM</link>,
	  or <link linkend="msg.game">GAME</link>.

	  The information included in the subtags depends on the ACTION
	  attribute of the update.  For instance a "table" "desc" update
	  would include only the description of the table, while a "player"
	  "add" update includes the full information about the player.  A
	  full list of these dependencies is not available at this time.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="rsp.list.player"><?dbhtml filename="rsp_list_players.html">
    <refmeta>
      <indexterm>
	<primary>PLAYER</primary>
      </indexterm>
      <refentrytitle>PLAYER</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>PLAYER</refname>
      <refpurpose>
	List entry describing one player.
      </refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
		      &lt;PLAYER ID='id' TYPE='type' TABLE='table'
		      LAG='lag' WINS='wins' LOSSES='losses' TIES='ties'
		      FORFEITS='forfeits' RATING='rating' RANKING='rating'
		      HIGHSCORE='highscore'/&gt;
		    </entry>
		  </row>

		  <row rowsep="1">
			<entry><emphasis role="bold">Data</emphasis></entry>
			<entry><emphasis role="bold">Type</emphasis></entry>
			<entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
			<entry>ID</entry>
			<entry>string</entry>
			<entry>Grubby</entry>
		  </row>

		  <row rowsep="1">
			<entry>TYPE</entry>
			<entry>string</entry>
			<entry>guest</entry>
		  </row>

		  <row rowsep="1">
			<entry>TABLE</entry>
			<entry>int</entry>
			<entry>-1</entry>
		  </row>

		  <row rowsep="1">
			<entry>LAG</entry>
			<entry>int</entry>
			<entry>1</entry>
		  </row>

		  <row rowsep="1">
			<entry>WINS</entry>
			<entry>int</entry>
			<entry>7</entry>
		  </row>

		  <row rowsep="1">
			<entry>LOSSES</entry>
			<entry>int</entry>
			<entry>3</entry>
		  </row>

		  <row rowsep="1">
			<entry>TIES</entry>
			<entry>int</entry>
			<entry>1</entry>
		  </row>

		  <row rowsep="1">
			<entry>RATING</entry>
			<entry>int</entry>
			<entry>1500</entry>
		  </row>

		  <row rowsep="1">
			<entry>RANKING</entry>
			<entry>int</entry>
			<entry>3</entry>
		  </row>

		  <row rowsep="1">
			<entry>HIGHSCORE</entry>
			<entry>long</entry>
			<entry>49807</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
        <para>
	      List entry containing the description of one player
	    </para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">ID</emphasis></term>
	    <listitem>
	      <para>
		Unique identifier of this player
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">TYPE</emphasis></term>
	    <listitem>
	      <para>
		Player type (can be 'guest', 'normal', 'admin' or 'bot')
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">TABLE</emphasis></term>
	    <listitem>
	      <para>
		ID number of table at which player is "sitting"; -1
		or not present if the player is not at a table.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">LAG</emphasis></term>
	    <listitem>
	      <para>
		Lag value of the player, which ranges from zero (ideal
		connection) to five (slow connection).
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">WINS</emphasis></term>
	    <listitem>
	      <para>
		The number of wins the player has.  This will be a
		non-negative integer, if present.  It will not be present
		if the player has no stats of this type (for whatever
		reason).  WINS, LOSSES, TIES, and FORFEITS will all be
		either present or not present (as a group).
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">LOSSES</emphasis></term>
	    <listitem>
	      <para>
		The number of losses the player has - a non-negative
		integer.  See WINS.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">TIES</emphasis></term>
	    <listitem>
	      <para>
		The number of ties the player has - a non-negative
		integer.  See WINS.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">FORFEITS</emphasis></term>
	    <listitem>
	      <para>
		The number of forfeits (abandoned games) the player has -
		a non-negative integer.  See WINS.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">RATING</emphasis></term>
	    <listitem>
	      <para>
		If present, it represents the player's rating.  This is
		generally done on an ELO scale, although the parameters may
		differ from those used for Chess.  It will not be given if
		the player has no rating.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">RANKING</emphasis></term>
	    <listitem>
	      <para>
		If present, provides the absolute ranking of the player.
		This will be a positive integer.  It will not be given if
		the player has no ranking.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">HIGHSCORE</emphasis></term>
	    <listitem>
	      <para>
		If present, provides the highest score the player has
		achieved at the current game.  It will not be given if
		there is no available highscore for this player.
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  The PLAYER is contained in a list sent from the server to the client
	  in response to
	  <link linkend="req.list">LIST</link> request tag of type 'player'.
	  It may also be contained within the
	  <link linkend="msg.update">UPDATE</link> tag send from the server
	  when player information changes.  If sent as part of a LIST then
	  the information will be complete - and any omissions are
	  intentional.  If sent as part of an UPDATE then only some
	  attributes will be present.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="rsp.list.table"><?dbhtml filename="rsp_list_tables.html">
    <refmeta>
      <indexterm>
	<primary>TABLE</primary>
      </indexterm>
      <refentrytitle>TABLE</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>TABLE</refname>
      <refpurpose>
	List entry containing one table
      </refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
			  <tbody>

			    <row rowsep="0">
			      <entry namest="C1" nameend="C3">
				    &lt;TABLE ID="id" GAME="game" STATUS="status" SEATS="seats"&gt;
					  &lt;DESC&gt;desc&lt;/DESC&gt;
					  &lt;SEAT NUM="num" TYPE="type"&gt;player&lt;/SEAT&gt;
					  ...
					&lt;/TABLE&gt;
				  </entry>
			    </row>

			    <row rowsep="1">
			      <entry><emphasis role="bold">Data</emphasis></entry>
			      <entry><emphasis role="bold">Type</emphasis></entry>
			      <entry><emphasis role="bold">Example</emphasis></entry>
			    </row>

			    <row rowsep="1">
			      <entry>ID</entry>
			      <entry>int</entry>
				  <entry>0</entry>
			    </row>

				<row rowsep="1">
				  <entry>GAME</entry>
				  <entry>int</entry>
				  <entry>0</entry>
				</row>

			    <row rowsep="1">
			      <entry>STATUS</entry>
			      <entry>int</entry>
				  <entry>1</entry>
			    </row>

			    <row rowsep="1">
			      <entry>SEATS</entry>
			      <entry>int</entry>
				  <entry>2</entry>
			    </row>

			    <row rowsep="1">
			      <entry>DESC</entry>
			      <entry>string</entry>
				  <entry>An empty table</entry>
			    </row>

			    <row rowsep="1">
			      <entry>NUM</entry>
			      <entry>int</entry>
				  <entry>0</entry>
			    </row>

			    <row rowsep="1">
			      <entry>TYPE</entry>
			      <entry>string</entry>
				  <entry>player</entry>
			    </row>

			    <row rowsep="1">
			      <entry>PLAYER</entry>
			      <entry>string</entry>
				  <entry>Grubby</entry>
			    </row>

			  </tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>The TABLE tag describes one table with all its properties</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">ID</emphasis></term>
	    <listitem>
	      <para>
		Unique identifier of this table in this room
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">GAME</emphasis></term>
	    <listitem>
	      <para>
		Associated game. Only used in updates with action 'add'.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">STATUS</emphasis></term>
	    <listitem>
	      <para>
		Current status of the table. Only used within updates with
		action 'status' or 'add'.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">SEATS</emphasis></term>
	    <listitem>
	      <para>
		Number of seats on this table.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">DESC</emphasis></term>
	    <listitem>
	      <para>
		Description of the table.
		Only sent when table is being added to the list,
		i.e. in updates with action 'add'.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">NUM</emphasis></term>
	    <listitem>
	      <para>
		Number of a seat.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">TYPE</emphasis></term>
	    <listitem>
	      <para>
		Type of a seat, which can be 'open', 'player',
		'reserved' or 'bot'.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">PLAYER</emphasis></term>
	    <listitem>
	      <para>
		Player name in case the type is either 'player' or 'reserved'.
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>
      <refsect2>
	<title>Usage</title>
	<para>
	  TABLE tags are sent in a list from the server to the client in
	  response to
	  <link linkend="req.list">LIST</link> when LIST is of type 'table',
	  and in
	  <link linkend="msg.update">UPDATE</link> tags of type 'table'.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="rsp.table.join"><?dbhtml filename="rsp_table_join.html">
    <refmeta>
      <indexterm>
        <primary>JOIN</primary>
      </indexterm>
      <refentrytitle>JOIN</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>JOIN</refname>
      <refpurpose>
	Message to indicate you've joined a table
      </refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
        <tgroup cols="3">
          <colspec colnum="1" colname="C1" align="left">
            <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>
		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
			  &lt;JOIN TABLE='table' SPECTATOR='spectator'/&gt;
	            </entry>
		  </row>

		  <row rowsep="1">
		    <entry>TABLE</entry>
		    <entry>integer</entry>
		    <entry>1</entry>
		  </row>

		  <row rowsep="1">
		    <entry>SPECTATOR</entry>
		    <entry>boolstring</entry>
		    <entry>false</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Tells the client that they have joined a table.  Currently each
            client and each player can only be at one table at a time.  The
            join will be initiated when the client sends either a 
            <link linkend="req.table.join">JOIN</link> request to join an
            existing table or a <link linkend="req.table.launch">LAUNCH</link>
            request to launch a new table (and subsequently join it).
      </para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">TABLE</emphasis></term>
	    <listitem>
	      <para>
                The index of the table that has been joined.  This will be
                a non-negative integer corresponding to the index sent in
                the <link linkend="rsp.list.table">TABLE</link> tag.
	      </para>
	    </listitem>
	  </varlistentry>
          <varlistentry>
            <term><emphasis role="bold">SPECTATOR</emphasis></term>
            <listitem>
              <para>
                Either "true" if the player is a spectator or "false" if
                they are a normal player.  This is generally determined
                based upon the client's
                <link linkend="req.table.join">JOIN</link> request.
              </para>
            </listitem>
          </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
          JOIN is sent from the server to the client to inform the player
          they've joined a table.  The client should take any necessary
          actions.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="rsp.table.leave"><?dbhtml filename="rsp_table_leave.html">
    <refmeta>
      <indexterm>
        <primary>LEAVE</primary>
      </indexterm>
      <refentrytitle>LEAVE</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>LEAVE</refname>
      <refpurpose>
	Message to indicate you've left a table
      </refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
        <tgroup cols="3">
          <colspec colnum="1" colname="C1" align="left">
            <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>
		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
			  &lt;LEAVE REASON='reason' PLAYER='player'/&gt;
	            </entry>
		  </row>

		  <row rowsep="1">
		    <entry>REASON</entry>
		    <entry>string</entry>
		    <entry>normal</entry>
		  </row>

		  <row rowsep="1">
		    <entry>PLAYER</entry>
		    <entry>player</entry>
		    <entry>jdorje</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>
        Tells the client that they have left a table.  This may be initiated
        by the player sending the server a
        <link linkend="req.table.leave">LEAVE</link> request, by the game
        server exiting when the game is over, by the player being booted
        from the table, or by the game server aborting.  In any of the cases
        the client should make sure the game client exits normally.
      </para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">REASON</emphasis></term>
	    <listitem>
	      <para>
                The reason the player left the table, currently one of
                "normal", "boot", "gameover", or "gameerror".
	      </para>
	    </listitem>
	  </varlistentry>
          <varlistentry>
            <term><emphasis role="bold">PLAYER</emphasis></term>
            <listitem>
              <para>
                The name of the (remote) player responsible for the leave.
                This is currently only provided for the "boot" leave, where
                it gives the name of the player who initiated the boot.
              </para>
            </listitem>
          </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  LEAVE is sent from the server to the client to tell of a table
          leave.  The client should take any necessary actions.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="rsp.result"><?dbhtml filename="rsp_result.html">
    <refmeta>
      <indexterm>
	<primary>RESULT</primary>
      </indexterm>
      <refentrytitle>RESULT</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>RESULT</refname>
      <refpurpose>
	General message to indicate the result of a request
      </refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
			<tbody>

			  <row rowsep="0">
			    <entry namest="C1" nameend="C3">
				  &lt;RESULT ACTION="action" CODE="code"/&gt;
				</entry>
			  </row>

			  <row rowsep="1">
			    <entry><emphasis role="bold">Data</emphasis></entry>
			    <entry><emphasis role="bold">Type</emphasis></entry>
			    <entry><emphasis role="bold">Example</emphasis></entry>
			  </row>

			  <row rowsep="1">
			    <entry>ACTION</entry>
			    <entry>string</entry>
			    <entry>list</entry>
			  </row>

			  <row rowsep="1">
			    <entry>CODE</entry>
			    <entry>string</entry>
			    <entry>ok</entry>
			  </row>

			</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Server response to any request, embedding the answer data</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">ACTION</emphasis></term>
	    <listitem>
	      <para>
		The request type this result is referring to.  Actions include
		'motd', 'list', 'enter', 'chat', 'launch', 'join', 'leave',
		'reseat', 'update', 'protocol', 'channel', 'login', and
		'pong'.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">CODE</emphasis></term>
	    <listitem>
	      <para>
		Result indicator: either 'ok' or an error string.  Errors
		may include 'usr lookup', 'bad options', 'room full',
		'table full', table empty', launch fail', 'join fail',
		'no table', 'leave fail', 'leave forbidden',
		'already logged in', 'not logged in', 'not in room',
		'at table', 'in transit', 'no permission', 'bad xml',
		'seat assign fail', 'no channel', or 'too long'.
		The client should behave sanely when
		it receives an unrecognized error.
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  RESULT is sent from the server to the client in
	  response to
	  <link linkend="req.list">LIST</link>,
	  <link linkend="req.enter">ENTER</link>,
	  <link linkend="req.table.launch">LAUNCH</link>,
	  <link linkend="req.table.join">JOIN</link>,
	  <link linkend="req.table.leave">LEAVE</link>,
	  <link linkend="req.chat">CHAT</link> and
	  <link linkend="req.login">LOGIN</link> requests.  Note that in
	  some of these cases (e.g. LIST) the response to the request will be
	  contained within the RESULT, whereas in others it will not.  The
	  logic on which is which is reasonable, but nonetheless the lack of 
	  consistency may be confusing.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="rsp.list"><?dbhtml filename="rsp_list.html">
    <refmeta>
      <indexterm>
	<primary>LIST</primary>
      </indexterm>
      <refentrytitle>LIST</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>LIST</refname>
      <refpurpose>
	Server response to request for list of rooms or list of games
      </refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
			<tbody>

			  <row rowsep="0">
			    <entry namest="C1" nameend="C3">
				  &lt;LIST TYPE="type" ROOM="room"&gt;
				  &lt;/LIST&gt;
				</entry>
			  </row>

			  <row rowsep="1">
			    <entry><emphasis role="bold">Data</emphasis></entry>
			    <entry><emphasis role="bold">Type</emphasis></entry>
			    <entry><emphasis role="bold">Example</emphasis></entry>
			  </row>

			  <row rowsep="1">
			    <entry>TYPE</entry>
			    <entry>string</entry>
			    <entry>room</entry>
			  </row>

			  <row rowsep="1">
			    <entry>ROOM</entry>
				<entry>int</entry>
				<entry>1</entry>
			  </row>

			</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Server response to request for list of rooms or game types</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">TYPE</emphasis></term>
	    <listitem>
	      <para>
		Type of list, either 'room', 'game', 'table' or 'player'
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">ROOM</emphasis></term>
	    <listitem>
	      <para>
		The room to which this list belongs. Only used for 'table' and
		'player'.
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  The LIST is sent from the server to the client in
	  response to the client request named
	  <link linkend="req.list">LIST</link>, and may contain either
	  <link linkend="rsp.list.table">TABLE</link> or
	  <link linkend="rsp.list.player">PLAYER</link> or
	  <link linkend="msg.game">GAME</link> or
	  <link linkend="msg.room">ROOM</link> entries.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="rsp.chat"><?dbhtml filename="rsp_chat.html">
    <refmeta>
      <indexterm>
	<primary>CHAT</primary>
      </indexterm>
      <refentrytitle>CHAT</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>CHAT</refname>
      <refpurpose>Server response to chat message request</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
			  &lt;CHAT TYPE="type" FROM="from"&gt;
			    &lt;![CDATA[...]]&gt;
			  &lt;/CHAT&gt;
			</entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
		    <entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
		    <entry>TYPE</entry>
		    <entry>string</entry>
			<entry>private</entry>
		  </row>

		  <row rowsep="1">
		    <entry>FROM</entry>
			<entry>string</entry>
			<entry>Grubby</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Server response to player chat request</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">TYPE</emphasis></term>
	    <listitem>
	      <para>
		Type of chat message, which can be one of "normal",
		"announce", "beep", "private", or "table".
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">FROM</emphasis></term>
	    <listitem>
	      <para>
		Player from which this message originates
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  The CHAT response tag is sent from the server to client to handle
	  chat message requests via the
	  <link linkend="req.chat">CHAT</link> tag.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

</section>

<section id ="client-to-server"><title>Client to server messages</title>

  <refentry id="req.login"><?dbhtml filename="req_login.html">
    <refmeta>
      <indexterm>
	<primary>LOGIN</primary>
      </indexterm>
      <refentrytitle>LOGIN</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>LOGIN</refname>
      <refpurpose>Client requested login</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
			  &lt;LOGIN TYPE="type"&gt;
			    &lt;NAME&gt;name&lt;/NAME&gt;
				&lt;PASSWORD&gt;password&lt;/PASSWORD&gt;
			  &lt;/LOGIN&gt;
			</entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
		    <entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
		    <entry>TYPE</entry>
			<entry>string</entry>
			<entry>guest</entry>
		  </row>

		  <row rowsep="1">
		    <entry>NAME</entry>
		    <entry>string</entry>
			<entry>Gandalf</entry>
		  </row>

		  <row rowsep="1">
		    <entry>PASSWORD</entry>
		    <entry>string</entry>
			<entry>xxxx</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Client requested login</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">TYPE</emphasis></term>
	    <listitem>
	      <para>
		Type of login, which can be one of "normal", "guest" or "first"
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">NAME</emphasis></term>
	    <listitem>
	      <para>
		Login name
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">PASSWORD</emphasis></term>
	    <listitem>
	      <para>
		Player password, which is only used for registered ("normal")
		players
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  The LOGIN tag is sent from the client to the server to
	  request a player login. The request may come after
	  <link linkend="msg.server.server">SERVER</link>.
	  The client must have started the SESSION in advance.
	  The server will respond to the request with a
	  <link linkend="rsp.result">RESULT</link> tag
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="req.list"><?dbhtml filename="req_list.html">
    <refmeta>
      <indexterm>
	<primary>LIST</primary>
      </indexterm>
      <refentrytitle>LIST</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>LIST</refname>
      <refpurpose>
	Client request for list of rooms or games on the server,
	or of tables or players in a room
      </refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
			  &lt;LIST TYPE="type" FULL="full"/&gt;
			</entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
		    <entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
		    <entry>TYPE</entry>
		    <entry>string</entry>
			<entry>room</entry>
		  </row>

		  <row rowsep="1">
		    <entry>FULL</entry>
		    <entry>boolstring</entry>
			<entry>true</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>
	    Client request for list of rooms or game types on the server,
		or (when in a room) for list of tables or list of players
	  </para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">TYPE</emphasis></term>
	    <listitem>
	      <para>
		The type may be 'room' for the room list, and 'game' to receive
		the game types list.
		Likewise, 'player' and 'table' are used to retrieve room information.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">FULL</emphasis></term>
	    <listitem>
	      <para>
		Verbosity flag. Set to 'false' for short room
		descriptions, 'true' for full descriptions.
		This is only used for the 'room' type.
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>
      <refsect2>
	<title>Usage</title>
	<para>
	  The &lt;LIST&gt; tag is sent from the client to the server to
	  request a list of rooms, game types, tables or players.
	  The server will respond with the appropriate
	  <link linkend="rsp.result">RESULT</link> tag which contains
	  a <link linkend="rsp.list">LIST</link>.
	  This request is only valid once the player has successfully
	  logged in for 'room' and 'game' types (ie. after the login
	  <link linkend="rsp.result">RESULT</link>), and only after
	  the player has entered a room (for 'table' and 'player' types).
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="req.table.launch"><?dbhtml filename="req_table_launch.html">
    <refmeta>
      <indexterm>
	<primary>LAUNCH</primary>
      </indexterm>
      <refentrytitle>LAUNCH</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>LAUNCH</refname>
      <refpurpose>Client request for new table launch</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
			<tbody>

			  <row rowsep="0">
			    <entry>
				  &lt;LAUNCH&gt;
				    ...
				  &lt;/LAUNCH&gt;
				</entry>
			  </row>

			  <row rowsep="1">
			    <entry><emphasis role="bold">Data</emphasis></entry>
			    <entry><emphasis role="bold">Type</emphasis></entry>
			    <entry><emphasis role="bold">Example</emphasis></entry>
			  </row>

			  <row rowsep="1">
			    <entry namest="C1" nameend="C3">No data</entry>
			  </row>

			</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Client request for new table launch</para>
      <refsect2>
	<title>Usage</title>
	<para>
	  The LAUNCH tag request a table to be launched in the current room.
	  Therefore, each LAUNCH request contains one tag of type
	  <link linkend="rsp.list.table">TABLE</link>.
	  The server will respond with a
	  <link linkend="rsp.result">RESULT</link> tag, followed by an
	  <link linkend="msg.update">UPDATE</link> of type 'table' upon success.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="req.table.join"><?dbhtml filename="req_table_join.html">
    <refmeta>
      <indexterm>
	<primary>JOIN</primary>
      </indexterm>
      <refentrytitle>JOIN</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>JOIN</refname>
      <refpurpose>Client request to join a table</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
			  &lt;JOIN TABLE="table" SPECTATOR="spectator"&gt;
			</entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
			<entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
		    <entry>TABLE</entry>
		    <entry>int</entry>
			<entry>0</entry>
		  </row>

		  <row rowsep="1">
		    <entry>SPECTATOR</entry>
		    <entry>boolstring</entry>
			<entry>true</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Client request to join table</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">TABLE</emphasis></term>
	    <listitem>
	      <para>
		The identifier of table the player wishes to join
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">SPECTATOR</emphasis></term>
	    <listitem>
	      <para>
		Whether to join as spectator (when true) or not
		(when false or omitted).
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  JOIN is sent from client to the server to
	  request a table join. The server will respond with
	  <link linkend="rsp.result">RESULT</link> telling us the success
          of the action.  If the action was successful the client will also
          receive a <link linkend="rsp.table.join">JOIN</link>, which we
          should act upon.  If the join succeeds it is likely an
	  <link linkend="msg.update">UPDATE</link> of type 'table' will also
          be necessary..
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="req.table.leave"><?dbhtml filename="req_table_leave.html">
    <refmeta>
      <indexterm>
	<primary>LEAVE</primary>
      </indexterm>
      <refentrytitle>LEAVE</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>LEAVE</refname>
      <refpurpose>Client request to leave table</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
			  &lt;LEAVE FORCE="force"&gt;
			</entry>
		  </row>

		  <row rowsep="1">
		    <entry>FORCE</entry>
		    <entry>boolstring</entry>
			<entry>false</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Server response to player request to leave tablet</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">FORCE</emphasis></term>
	    <listitem>
	      <para>
		Force leaving the table even though the game doesn't support it.
		The game would then be cancelled.
		For spectators, this flag is ignored.
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  LEAVE is sent from the client to the server to
	  request a table leave.  The server will respons with a
	  <link linkend="rsp.result">RESULT</link> message as well as a
          <link linkend="rsp.table.leave">LEAVE</link> message with reason
          "normal" if the leave succeeded.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="req.chat"><?dbhtml filename="req_chat.html">
    <refmeta>
      <indexterm>
	<primary>CHAT</primary>
      </indexterm>
      <refentrytitle>CHAT</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>CHAT</refname>
      <refpurpose>Client chat message request</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
			  &lt;CHAT TYPE='type' TO='to'&gt;
			   &lt;![CDATA[...]]&gt;
			  &lt;/CHAT&gt;
			</entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
		    <entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
		    <entry>TYPE</entry>
		    <entry>string</entry>
		    <entry>normal</entry>
		  </row>

		  <row rowsep="1">
		    <entry>TO</entry>
		    <entry>string</entry>
		    <entry>josef</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Client chat message request</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">TYPE</emphasis></term>
	    <listitem>
	      <para>
		Chat type. Can be one of "normal", "announce", "beep",
		"private", or "table".
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><emphasis role="bold">TO</emphasis></term>
	    <listitem>
	      <para>
		Name of player who will receive message.
		This attribute is needed for 'beep' and 'private' messages,
		but not for 'normal', 'announce', or 'table'.  The client
		should behave sanely if this contains incorrect data or is
		not present.
	      </para>
	    </listitem>
	  </varlistentry>

	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  A CHAT request is sent from the client to send a chat
	  message. The server will respond with an appropriate
	  <link linkend="rsp.result">RESULT</link> which embeds
	  a <link linkend="rsp.chat">CHAT</link> tag.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="req.enter"><?dbhtml filename="req_enter.html">
    <refmeta>
      <indexterm>
	<primary>ENTER</primary>
      </indexterm>
      <refentrytitle>ENTER</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>ENTER</refname>
      <refpurpose>Request to change rooms</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
			  &lt;ENTER ROOM="room"&gt;
			</entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
		    <entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
		    <entry>ROOM</entry>
		    <entry>int</entry>
			<entry>1</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Request to change rooms</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">ROOM</emphasis></term>
	    <listitem>
	      <para>
		The room identifier of requested destination room
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  ENTER is sent from the client to the server to
	  request a room change.  It is expected that the server
	  will respond with
	  <link linkend="rsp.result">RESULT</link>.
	</para>
      </refsect2>
    </refsect1>
  </refentry>

  <refentry id="req.channel"><?dbhtml filename="req_channel.html">
    <refmeta>
      <indexterm>
	<primary>CHANNEL</primary>
      </indexterm>
      <refentrytitle>CHANNEL</refentrytitle>
    </refmeta>

    <refnamediv>
      <refname>CHANNEL</refname>
      <refpurpose>Request for a direct game connection</refpurpose>
    </refnamediv>

    <refsynopsisdiv><title>Synopsis</title>
      <informaltable>
	<tgroup cols="3">
	  <colspec colnum="1" colname="C1" align="left">
	    <colspec colnum="2" colname="C2">
	      <colspec colnum="3" colname="C3">
		<tbody>

		  <row rowsep="0">
		    <entry namest="C1" nameend="C3">
			  &lt;CHANNEL ID="id"&gt;
			</entry>
		  </row>

		  <row rowsep="1">
		    <entry><emphasis role="bold">Data</emphasis></entry>
		    <entry><emphasis role="bold">Type</emphasis></entry>
		    <entry><emphasis role="bold">Example</emphasis></entry>
		  </row>

		  <row rowsep="1">
		    <entry>ID</entry>
		    <entry>string</entry>
			<entry>Grubby</entry>
		  </row>

		</tbody>
	</tgroup>
      </informaltable>
    </refsynopsisdiv>

    <refsect1>
      <title>Description</title>
      <para>Request for a direct connection between game server and game client</para>
      <refsect2>
	<title>Message Data</title>
	<variablelist>
	  <varlistentry>
	    <term><emphasis role="bold">ID</emphasis></term>
	    <listitem>
	      <para>
		Identifier of the created channel.
		This equals the name of the player who launches
		or joins a game.
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect2>

      <refsect2>
	<title>Usage</title>
	<para>
	  To obtain a channel, the CHANNEL tag is sent within a separate
	  <link linkend="msg.session">SESSION</link>.
	</para>
      </refsect2>
    </refsect1>
  </refentry>


</section>


