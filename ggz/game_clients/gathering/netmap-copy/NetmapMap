////////////////////////////////////////////////////////////////////////////
//                                                                        //
// The Netmap C++ Class Library                                           //
//                                                                        //
// Copyright (C) 2001 Josef Spillner                                      //
// dr_maux@users.sourceforge.net                                          //
// The MindX Open Source Project                                          //
// http://mindx.sourceforge.net/development/netmap                        //
//                                                                        //
// Published under GNU GPL conditions                                     //
//                                                                        //
////////////////////////////////////////////////////////////////////////////

#ifndef NETMAP_MAP
#define NETMAP_MAP

// Netmap include files
#include <Netmap>
#include <NetmapResource>

// C++ include files
#include <list>

/**
	This class stores all local information about a map. A game needs exactly one instance of it.
	Such a map acts as a proxy - all requested data is searched in the cache.
	If it cannot be found, the resource manager is called (@ref NetmapResource). This can be either
	local (@ref NetmapResourceFile) or by transmitting data over networks.
*/

class NetmapMap
{
	public:
		/** Constructor */
		NetmapMap();

		/** Destructor */
		~NetmapMap();

		/** Specify how large a vtile should be. The default is 16 x 16. */
		void setVtileSize(Ncoord width, Ncoord height);

		/** Set the local vtile buffer limit. The default is 4096, that is 1 MB of memory. */
		void setVtileCacheSize(Ncoord number);

		/** Receive a vtile from the resources. */
		Nvtile *vtile(Ncoord vx, Ncoord vy);

		/** Receive a single tile from the resources. */
		Ntile *tile(Ncoord x, Ncoord y);

		/** Automatically retrieve all missing data. */
		void update();

		/** Set the player's position. */
		void setPosition(Ncoord x, Ncoord y);

		/** Specify how far a player can see, both horizontally and vertically. The default is 3 x 3, specified by 1 x 1. */
		void setHorizon(Ncoord width, Ncoord height);

		/** Return the width of the map. */
		Ncoord mapWidth();

		/** Return the height of the map. */
		Ncoord mapHeight();

		/** Set the resource object. */
		void setResource(NetmapResource *resource);

		/** Get horizontal position. */
		Ncoord x();

		/** Get vertical position. */
		Ncoord y();

	private:
		/** Dynamic list of all vtiles */
		list<Nvtile> vtilelist;

		/** The player's position on the map */
		Ncoord m_player_x, m_player_y;

		/** The spcified horizon */
		Ncoord m_horizon_width, m_horizon_height;

		/** Map cache size in vtiles */
		Ncoord m_map_cache;

		/** Resource */
		NetmapResource *m_resource;

		/** vtile size */
		Ncoord m_vtile_width, m_vtile_height;
};

#endif
