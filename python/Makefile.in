# GGZ Gaming Zone Python Package
# Makefile.in for use with autoconf (but not automake)

# Release version number
version = 0.0.12

# prefix: All-purpose prefix (/usr)
prefix = @prefix@
# bindir: For executable programs (/usr/bin)
bindir = @bindir@
# datadir: For game data files (/usr/share)
datadir = @datadir@

# xdg_datadir: For desktop integration files (/usr/share/applications)
xdg_datadir = @xdg_datadir@
# ggzd_confdir: For GGZ integration files (/etc/ggzd)
ggzd_confdir = @ggzd_confdir@

# ggz-config: either ggz-config or 'true' if disabled
ggz-config = @GGZ_CONFIG@ -D

# some default autoconf variables
exec_prefix = ${prefix}
sysconfdir = ${prefix}/etc

# Start of ggz-python configuration
ggzmod = @enable_ggzmod@
ggzdmod = @enable_ggzdmod@
ggzcore = @enable_ggzcore@
ggzchess = @enable_ggzchess@
rsvgsdl = @enable_rsvgsdl@

wrappers =
instwrappers =

ifeq ($(ggzmod),yes)
	wrappers += ggzmod-build
	instwrappers += ggzmod-install
endif
ifeq ($(ggzdmod),yes)
	wrappers += ggzdmod-build
	instwrappers += ggzdmod-install
endif
ifeq ($(ggzcore),yes)
	wrappers += ggzcore-build
	instwrappers += ggzcore-install
endif
ifeq ($(rsvgsdl),yes)
	wrappers += rsvgsdl-build
	instwrappers += rsvgsdl-install
endif
ifeq ($(ggzchess),yes)
	wrappers += ggzchess-build
	instwrappers += ggzchess-install
endif

all: $(wrappers) po-build
	@echo "ready with building ggz-python"

install: $(instwrappers) po-install man-install install-ggzboard install-rest
	@echo "ready with installation of ggz-python"
	@echo
	@echo "Please read INSTALL to find out about setting PYTHONPATH!"

ggzmod-build:
	@echo Building library PyGGZMod
	cd pyggzmod && python setup.py build

ggzdmod-build:
	@echo Building library PyGGZdMod
	cd pyggzdmod && python setup.py build

ggzcore-build:
	@echo Building library PyGGZCoreSimple
	cd pyggzcore && python setup.py build

rsvgsdl-build:
	@echo Building library PyRsvgSDL
	cd pyrsvgsdl && python setup.py build

ggzchess-build:
	@echo Building library PyGGZChess
	cd chess && make
	cd pyggzchess && python setup.py build

clean:
	@echo Cleaning up
	rm -rf */build
	cd chess && make clean

ggzmod-install:
	@echo Installing library PyGGZMod
	cd pyggzmod && python setup.py install --prefix=$(DESTDIR)$(prefix)

ggzdmod-install:
	@echo Installing library PyGGZdMod
	cd pyggzdmod && python setup.py install --prefix=$(DESTDIR)$(prefix)

ggzcore-install:
	@echo Installing library PyGGZCoreSimple
	cd pyggzcore && python setup.py install --prefix=$(DESTDIR)$(prefix)

rsvgsdl-install:
	@echo Installing library PyRsvgSDL
	cd pyrsvgsdl && python setup.py install --prefix=$(DESTDIR)$(prefix)

ggzchess-install:
	@echo Installing library PyGGZChess
	cd pyggzchess && python setup.py install --prefix=$(DESTDIR)$(prefix)

po-build:
	@echo Building internationalization files
	cd po && make all-local prefix=$(DESTDIR)$(prefix)

po-install:
	@echo Installing internationalization files
	cd po && make install prefix=$(DESTDIR)$(prefix)

man-install:
	@echo Installing manual pages
	mkdir -p $(DESTDIR)$(prefix)/share
	mkdir -p $(DESTDIR)$(prefix)/share/man
	mkdir -p $(DESTDIR)$(prefix)/share/man/man6
	cp man/*.6 $(DESTDIR)$(prefix)/share/man/man6

install-rest:
	@echo Installing game Dresden
	mkdir -p $(DESTDIR)$(bindir)
	cp dresden/dresden.py $(DESTDIR)$(bindir)
	mkdir -p $(DESTDIR)$(datadir)/ggz/dresden/
	cp dresden/*.png $(DESTDIR)$(datadir)/ggz/dresden

	@echo Installing game Escape/SDL
	mkdir -p $(DESTDIR)$(bindir)
	cp escape-sdl/escape-sdl $(DESTDIR)$(bindir)
	$(ggz-config) --install --force --modfile=escape-sdl/module.dsc
	mkdir -p $(DESTDIR)$(xdg_datadir)
	cp escape-sdl/escape-sdl.desktop $(DESTDIR)$(xdg_datadir)

	@echo Installing game Xadrez Chines
	mkdir -p $(DESTDIR)$(bindir)
	cp xadrez-chines/xadrez-chines $(DESTDIR)$(bindir)
	cp xadrez-chines/xadrez-chines-server $(DESTDIR)$(bindir)
	mkdir -p $(DESTDIR)$(prefix)/lib/site-python/
	cp xadrez-chines/xadrezlib.py $(DESTDIR)$(prefix)/lib/site-python
	mkdir -p $(DESTDIR)$(datadir)/ggz/xadrez-chines/
	mkdir -p $(DESTDIR)$(datadir)/ggz/xadrez-chines/themes/
	mkdir -p $(DESTDIR)$(datadir)/ggz/xadrez-chines/themes/dark/
	mkdir -p $(DESTDIR)$(datadir)/ggz/xadrez-chines/themes/orig/
	cp xadrez-chines/themes/dark/*.png $(DESTDIR)$(datadir)/ggz/xadrez-chines/themes/dark
	cp xadrez-chines/themes/orig/*.png $(DESTDIR)$(datadir)/ggz/xadrez-chines/themes/orig
	$(ggz-config) --install --force --modfile=xadrez-chines/module.dsc
	cp xadrez-chines/xadrez-chines-server.dsc $(DESTDIR)$(ggzd_confdir)/games
	cp xadrez-chines/xadrez-chines-server.room $(DESTDIR)$(ggzd_confdir)/rooms
	mkdir -p $(DESTDIR)$(xdg_datadir)
	cp xadrez-chines/xadrez-chines.desktop $(DESTDIR)$(xdg_datadir)

	@echo Installing external game GNU Go support files
	mkdir -p $(DESTDIR)$(bindir)
	cp go/goclient $(DESTDIR)$(bindir)
	cp go/goserver $(DESTDIR)$(bindir)
	cp go/goclient.helper $(DESTDIR)$(bindir)
	$(ggz-config) --install --force --modfile=go/module.dsc
	cp go/goserver.dsc $(DESTDIR)$(ggzd_confdir)/games
	cp go/goserver.room $(DESTDIR)$(ggzd_confdir)/rooms

	@echo Installing core client Vibora
	mkdir -p $(DESTDIR)$(bindir)
	cp vibora/vibora $(DESTDIR)$(bindir)
	mkdir -p $(DESTDIR)$(datadir)/ggz/vibora/
	cp vibora/*.png $(DESTDIR)$(datadir)/ggz/vibora

	@echo Installing SDL newstuff dialog and player table dialog
	mkdir -p $(DESTDIR)$(prefix)/lib/site-python/
	cp lib/sdlnewstuff.py $(DESTDIR)$(prefix)/lib/site-python
	cp lib/playertable.py $(DESTDIR)$(prefix)/lib/site-python
	cp lib/ggzsettings.py $(DESTDIR)$(prefix)/lib/site-python

install-ggzboard:
	@echo Installing GGZBoard framework and games
	mkdir -p $(DESTDIR)$(bindir)
	cp ggzboard/ggzboard $(DESTDIR)$(bindir)
	mkdir -p $(DESTDIR)$(datadir)/ggz/ggzboard/
	cp ggzboard/*.jpg $(DESTDIR)$(datadir)/ggz/ggzboard
	mkdir -p $(DESTDIR)$(datadir)/ggz/ggzboard/common/
	cp ggzboard/common/*.png $(DESTDIR)$(datadir)/ggz/ggzboard/common
	mkdir -p $(DESTDIR)$(xdg_datadir)
	cp ggzboard/ggzboard.desktop $(DESTDIR)$(xdg_datadir)
	mkdir -p $(DESTDIR)$(datadir)/ggz/ggzboard/checkers
	mkdir -p $(DESTDIR)$(datadir)/ggz/ggzboard/chess
	mkdir -p $(DESTDIR)$(datadir)/ggz/ggzboard/go
	mkdir -p $(DESTDIR)$(datadir)/ggz/ggzboard/hnefatafl
	mkdir -p $(DESTDIR)$(datadir)/ggz/ggzboard/reversi
	mkdir -p $(DESTDIR)$(datadir)/ggz/ggzboard/madn
	mkdir -p $(DESTDIR)$(datadir)/ggz/ggzboard/connectx
	cp ggzboard/checkers/*.svg $(DESTDIR)$(datadir)/ggz/ggzboard/checkers
	cp ggzboard/chess/*.svg $(DESTDIR)$(datadir)/ggz/ggzboard/chess
	cp ggzboard/go/*.svg $(DESTDIR)$(datadir)/ggz/ggzboard/go
	cp ggzboard/hnefatafl/*.svg $(DESTDIR)$(datadir)/ggz/ggzboard/hnefatafl
	cp ggzboard/reversi/*.svg $(DESTDIR)$(datadir)/ggz/ggzboard/reversi
	cp ggzboard/madn/*.svg $(DESTDIR)$(datadir)/ggz/ggzboard/madn
	cp ggzboard/connectx/*.svg $(DESTDIR)$(datadir)/ggz/ggzboard/connectx
	mkdir -p $(DESTDIR)$(prefix)/lib/site-python/
	cp ggzboard/ggzboard_net.py $(DESTDIR)$(prefix)/lib/site-python
	cp ggzboard/bogaprot.py $(DESTDIR)$(prefix)/lib/site-python
	cp ggzboard/bogaprotclient.py $(DESTDIR)$(prefix)/lib/site-python
	cp ggzboard/module_*.py $(DESTDIR)$(prefix)/lib/site-python
	cp ggzboard/net_*.py $(DESTDIR)$(prefix)/lib/site-python
	mkdir -p $(DESTDIR)$(prefix)/lib/ggzd/
	cp ggzboard/server_*.py $(DESTDIR)$(prefix)/lib/ggzd
	$(ggz-config) --install --force --modfile=ggzboard/module_checkers.dsc
	$(ggz-config) --install --force --modfile=ggzboard/module_chess.dsc
	$(ggz-config) --install --force --modfile=ggzboard/module_go.dsc
	$(ggz-config) --install --force --modfile=ggzboard/module_hnefatafl.dsc
	$(ggz-config) --install --force --modfile=ggzboard/module_reversi.dsc
	$(ggz-config) --install --force --modfile=ggzboard/module_connectx.dsc
	$(ggz-config) --install --force --modfile=ggzboard/module_ludo.dsc
	$(ggz-config) --install --force --modfile=ggzboard/module_arimaa.dsc
	mkdir -p $(DESTDIR)$(ggzd_confdir)/games
	mkdir -p $(DESTDIR)$(ggzd_confdir)/rooms
	cp ggzboard/server_hnefatafl.dsc $(DESTDIR)$(ggzd_confdir)/games
	cp ggzboard/server_checkers.dsc $(DESTDIR)$(ggzd_confdir)/games
	cp ggzboard/server_ludo.dsc $(DESTDIR)$(ggzd_confdir)/games
	cp ggzboard/server_arimaa.dsc $(DESTDIR)$(ggzd_confdir)/games
	cp ggzboard/server_hnefatafl.room $(DESTDIR)$(ggzd_confdir)/rooms
	cp ggzboard/server_checkers.room $(DESTDIR)$(ggzd_confdir)/rooms
	cp ggzboard/server_ludo.room $(DESTDIR)$(ggzd_confdir)/rooms
	cp ggzboard/server_arimaa.room $(DESTDIR)$(ggzd_confdir)/rooms

dist:
	rm -rf ../ggz-python-$(version)
	cp -r ../python ../ggz-python-$(version)
	find ../ggz-python-$(version) -name .svn | xargs rm -rf
	cd .. && tar cvzf ggz-python-$(version).tar.gz ggz-python-$(version)

