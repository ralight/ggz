# This is the msys/mingw Makefile for libggz/src

# Subdirectories to descend into. Any subdir that contains a 
# Makefile.msys will use that over the standard Makefile
SUBDIRS=security

LIBNAME=libggz
OBJECTS=conf.o easysock.o ggz_common.o list.o memory.o misc.o msg.o numberlist.o stack.o xmlelement.o security/base64.o security/ggz_tls_gnutls.o security/ggz_tls_none.o security/ggz_tls_openssl.o security/hashfunc.o

DLLWRAP=dllwrap
DLLADD=-lpthread -lwsock32
INSTALL=@INSTALL@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
datadir = @datadir@
includedir = @includedir@
infodir = @infodir@
libdir = @libdir@
libexecdir = @libexecdir@
localstatedir = @localstatedir@
mandir = @mandir@
oldincludedir = @oldincludedir@
sbindir = @sbindir@
sharedstatedir = @sharedstatedir@
sysconfdir = @sysconfdir@

all : Makefile
	list='$(SUBDIRS)'; for subdir in $$list; do \
		test "$$subdir" = . || \
		if test -f "$$subdir/Makefile.msys"; then \
			(cd $$subdir && $(MAKE) -f Makefile.msys); \
		else	(cd $$subdir && $(MAKE)); fi; \
	done
	$(MAKE)
	$(DLLWRAP) --export-all --driver-name=$(CC) -s --output-def $(LIBNAME).def --implib $(LIBNAME).a -o $(LIBNAME).dll $(OBJECTS) $(DLLADD)


install : all
	# Everything has been installed by our parent.
	# We need to remove the static lib installed and install our own.
	list='$(SUBDIRS)'; for subdir in $$list; do \
		test "$$subdir" = . || \
		if test -f "$$subdir/Makefile.msys"; then \
			(cd $$subdir && $(MAKE) -f Makefile.msys install); fi; \
	done

	rm -f "$(libdir)/$(LIBNAME).a"
	rm -f "$(libdir)/$(LIBNAME).la" 
	$(INSTALL) $(LIBNAME).a "$(libdir)"
	$(INSTALL) $(LIBNAME).dll "$(bindir)"


dist : all
	echo "This target is incomplete for msys"
	list='$(SUBDIRS)'; for subdir in $$list; do \
		test "$$subdir" = . || \
		if test -f "$$subdir/Makefile.msys"; then \
			(cd $$subdir && $(MAKE) -f Makefile.msys dist); \
		else	(cd $$subdir && $(MAKE) dist); fi; \
	done


clean :
	# We only need to clean subdirs with Makefile.msys in.
	list='$(SUBDIRS)'; for subdir in $$list; do \
		test "$$subdir" = . || \
		if test -f "$$subdir/Makefile.msys"; then \
			(cd $$subdir && $(MAKE) -f Makefile.msys clean); fi; \
	done
	rm -f $(LIBNAME).def
	rm -f $(LIBNAME).a
	rm -f $(LIBNAME).dll


distclean : clean
	# We only need to clean subdirs with Makefile.msys in.
	list='$(SUBDIRS)'; for subdir in $$list; do \
		test "$$subdir" = . || \
		if test -f "$$subdir/Makefile.msys"; then \
			(cd $$subdir && $(MAKE) -f Makefile.msys distclean); fi; \
	done


uninstall : 
	# We only need to uninstall subdirs with Makefile.msys in.
	list='$(SUBDIRS)'; for subdir in $$list; do \
		test "$$subdir" = . || \
		if test -f "$$subdir/Makefile.msys"; then \
			(cd $$subdir && $(MAKE) -f Makefile.msys uninstall); fi; \
	done
	rm -f $(libdir)/$(LIBNAME).a
	rm -f $(bindir)/$(LIBNAME).dll


Makefile :
	echo "Please run configure first"

